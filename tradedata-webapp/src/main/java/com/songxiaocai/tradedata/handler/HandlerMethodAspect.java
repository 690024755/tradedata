package com.songxiaocai.tradedata.handler;/* * Description:com.songxiaocai.tradedata.handler * @Date Create on 16:20 * @author <a href="mailto:yangyi@songxiaocai.com">yangyi</a> * @Version JDK 1.8 * @since version 1.0 Copyright 2019-02-21日SXC All Rights Reserved. */import com.alibaba.fastjson.JSON;import com.alibaba.fastjson.JSONObject;import com.songxiaocai.tradedata.tool.http.HttpRequestSimple;import com.songxiaocai.tradedata.tool.jedis.JedisTemplate;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.lang.Nullable;import org.springframework.web.servlet.HandlerInterceptor;import org.springframework.web.servlet.ModelAndView;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.util.HashMap;import java.util.Map;/** * 添加拦截器 */@Slf4jpublic class HandlerMethodAspect implements HandlerInterceptor {	Integer SESSION_MAX_AGE = 60 * 60 * 24 * 30;	@Autowired	JedisTemplate jedisTemplate;	/**	 * 启动项目直接登入erp	 * @param request	 * @param response	 * @param handler	 * @return	 * @throws Exception	 */	@Override	public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {		//使用erp登录		Map<String,String> hashmap=new HashMap<String,String>();		try {			hashmap.put("appKey", "18701298");			hashmap.put("bizCode", "erp_login");			hashmap.put("deviceUUID", "9a6c608fbc1f488edd7a14e9488397c5");			hashmap.put("mobilePhone", "18888888888");			hashmap.put("password", "12345");			String url = "https://gateway.songxiaocai.net/login/login";			HttpRequestSimple httpclent = new HttpRequestSimple();			log.info("登录请求报文:" + JSON.toJSONString(hashmap));			String resJson_login = httpclent.postSendHttpWeb(url, JSON.toJSONString(hashmap));			log.info("登录返回报文:" + resJson_login);			String sessionId = JSONObject.parseObject(resJson_login).getJSONObject("result").getString("sessionId");			StringBuffer redis_key = new StringBuffer("18888888888").append("-").append("18701298").append("-").append("erp_login");			jedisTemplate.set(redis_key.toString(), sessionId, SESSION_MAX_AGE);		}catch (Exception e){			log.info("获取登录session失败");		}finally {			//让目标资源执行，放行			return true;		}	}	@Override	public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, @Nullable ModelAndView modelAndView) throws Exception {	}	@Override	public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, @Nullable Exception ex) throws Exception {	}}